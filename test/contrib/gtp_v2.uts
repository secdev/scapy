# GTPv2 unit tests
#
# Type the following command to launch start the tests:
# $ test/run_tests -P "load_contrib('gtp_v2')" -t test/contrib/gtp_v2.uts

+ GTPv2

= GTPHeader v2, basic instantiation
gtp = IP()/UDP(dport=2123)/GTPHeader(gtp_type=1)
gtp.dport == 2123 and gtp.gtp_type == 1

= GTPV2EchoRequest, basic instantiation
gtp = IP()/UDP(dport=2123) / GTPHeader(seq=12345) / GTPV2EchoRequest()
gtp.dport == 2123 and gtp.seq == 12345 and gtp.gtp_type == 1 and gtp.T == 0

= GTPV2CreateSessionRequest, basic instantiation
gtp = IP() / UDP(dport=2123) / \
    GTPHeader(gtp_type="create_session_req", teid=2807, seq=12345) / \
    GTPV2CreateSessionRequest()
gtp.dport == 2123 and gtp.teid == 2807 and gtp.seq == 12345

= GTPV2EchoRequest, dissection
h = "333333333333222222222222810080c808004588002937dd0000fd1115490a2a00010a2a0002084b084b00152d0e4001000900000100030001000daa000000003f1f382f"
gtp = Ether(hex_bytes(h))
gtp.gtp_type == 1

= GTPV2EchoResponse, dissection
h = "3333333333332222222222228100e384080045fc002fd6d70000f21180d40a2a00010a2a0002084b084b001b00004002000f000001000300010001020002001000731cd7c5"
gtp = Ether(hex_bytes(h))
gtp.gtp_type == 2

= GTPV2ModifyBearerRequest, dissection
h = "3333333333332222222222228100a384080045b8004300000000fc1185350a2a00010a2a00027a76084b002f6c344822002392e9e1143652540052000100065d00120049000100055700090080000010927f000002ac79a28e"
gtp = Ether(hex_bytes(h))
gtp.gtp_type == 34

= IE_IMSI, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd00000000661759000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100235700090385000010927f00000250001600580700000000000000000000000000000000000000007200020040005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.IMSI == b"2080112345670000"

= IE_IMSI, basic instantiation
ie = IE_IMSI(ietype='IMSI', length=8, IMSI='2080112345670000')
ie.ietype == 1 and ie.IMSI == b'2080112345670000'
assert bytes(ie) == b'\x01\x00\x08\x00\x02\x08\x112Tv\x00\x00'

= IE_Cause, dissection
h = "3333333333332222222222228100838408004588004a00000000fd1193160a2a00010a2a0002084b824600366a744823002a45e679235ea151000200020010005d001800490001006c0200020010005700090081000010927f000002558d3b69"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.Cause == 16

= IE_Cause, basic instantiation
ie = IE_Cause(
    ietype='Cause', length=2, Cause='Request accepted', PCE=1, BCE=0, CS=0)
ie.ietype == 2 and ie.Cause == 16 and ie.PCE == 1 and ie.BCE == 0 and ie.CS == 0

= IE_Cause, basic instantiation 2
ie = IE_Cause(
    ietype='Cause', length=2, Cause='Request accepted', PCE=0, BCE=1, CS=0)
ie.ietype == 2 and ie.Cause == 16 and ie.PCE == 0 and ie.BCE == 1 and ie.CS == 0

= IE_Cause, basic instantiation 3
ie = IE_Cause(
    ietype='Cause', length=2, Cause='Request accepted', PCE=0, BCE=0, CS=1)
ie.ietype == 2 and ie.Cause == 16 and ie.PCE == 0 and ie.BCE == 0 and ie.CS == 1

= IE_RecoveryRestart, dissection
h = "3333333333332222222222228100838408004588002937dd0000fd1115490a2a00010a2a0002084b084b00152d0e400100095e4b1f00030001000daa000000003f1f382f"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.ietype == 3 and ie.restart_counter == 13

= IE_RecoveryRestart, basic instantiation
ie = IE_RecoveryRestart(
    ietype='Recovery Restart', length=1, restart_counter=17)
ie.ietype == 3 and ie.restart_counter == 17

= IE_APN, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[7]
ie.APN == b'aaaaaaaaaaaaaaaaaaaaaaaaa'

= IE_APN, basic instantiation
ie = IE_APN(ietype='APN', length=26, APN='aaaaaaaaaaaaaaaaaaaaaaaaa')
ie.ietype == 71 and ie.APN == b'aaaaaaaaaaaaaaaaaaaaaaaaa'
assert bytes(ie) == b'G\x00\x1a\x00\x19aaaaaaaaaaaaaaaaaaaaaaaaa'

= IE_AMBR, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[11]
ie.AMBR_Uplink == 5888 and ie.AMBR_Downlink == 42000

= IE_AMBR, basic instantiation
ie = IE_AMBR(
    ietype='AMBR', length=8, AMBR_Uplink=5888, AMBR_Downlink=42000)
ie.ietype == 72 and ie.AMBR_Uplink == 5888 and ie.AMBR_Downlink == 42000

= IE_EPSBearerID, dissection
h = "3333333333332222222222228100838408004580006d00000000f31180d20a2a00010a2a0002084b85930059e49a4823004d55819f6500ede7000200020010004c000600111111111111490001003248000800000061a8000249f07f000100005d001300490001000b0200020010005e00040039004f454a0004007f00000436f73a63"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[2]
ie.EBI == 50

= IE_EPSBearerID, basic instantiation
ie = IE_EPSBearerID(ietype='EPS Bearer ID', length=1, EBI=50)
ie.ietype == 73 and ie.EBI == 50

= IE_IP_Address, dissection
h = "3333333333332222222222228100838408004580006d00000000f31180d20a2a00010a2a0002084b85930059e49a4823004d84530d5a4cdee2000200020010004c00060011111111111149000100b248000800000061a8000249f07f000100005d00130049000100da0200020010005e00040039004f454a0004007f00000436f73a63"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[6]
ie.address == '127.0.0.4'

= IE_IP_Address, basic instantiation
ie = IE_IP_Address(ietype='IP Address', length=4, address='127.0.0.4')
ie.ietype == 74 and ie.address == '127.0.0.4'

= IE_MEI, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b00080071655774980786ff56000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[1]
ie.MEI == b"17567547897068"

= IE_MEI, basic instantiation
ie = IE_MEI(ietype='MEI', length=1, MEI=175675478970685)
ie.ietype == 75 and ie.MEI == 175675478970685

= IE_MSISDN, dissection
h = "3333333333332222222222228100838408004580006d00000000f31180d20a2a00010a2a0002084b85930059e49a4823004d55819f6500ede7000200020010004c000600111111111111490001003248000800000061a8000249f07f000100005d001300490001000b0200020010005e00040039004f454a0004007f00000436f73a63"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[1]
ie.digits == b'111111111111'

= IE_MSISDN, basic instantiation
ie = IE_MSISDN(ietype='MSISDN', length=6, digits='111111111111')
ie.ietype == 76 and ie.digits == b'111111111111'
assert bytes(ie) == b'L\x00\x06\x00\x11\x11\x11\x11\x11\x11'

= IE_Indication, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b00080071655774980786ff56000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[10]
ie.DAF == 0 and ie.DTF == 0 and ie.PS == 1 and ie.CCRSI == 0 and ie.CPRAI == 0 and ie.PPON == 0 and ie.CLII == 0 and ie.CPSR == 0

= IE_Indication, basic instantiation
ie = IE_Indication(ietype='Indication', length=8, PS=1, CPRAI=1)
ie.ietype == 77 and ie.PS == 1 and ie.CPRAI == 1

= IE_Indication, basic instantiation 2
ie = IE_Indication(ietype='Indication', length=8, DTF=1, PPSI=1)
ie.ietype == 77 and ie.DTF == 1 and ie.PPSI == 1

= IE_PCO, dissection
h = "333333333333222222222222810083840800458800a500000000fd1183bb0a2a00010a2a0002084b76a00091cf0b48210085bd574af24c68e300020002001000570009008b000010927f0000025700090187000010927f0000024f000500017f0000037f000100004e00220080000d040a2a0003000d040a2a00038021100300001081060a2a000483060a2a00045d00250049000100660200020010005700090081000010927f0000025700090285000010927f000002dd9f22c6"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[5]
ie.Protocols[0].address == '10.42.0.3'

= IE_PCO, basic instantiation
ie = IE_PCO(ietype='Protocol Configuration Options', length=8, Extension=1, PPP=3, Protocols=[
                   PCO_DNS_Server_IPv4(type='DNS Server IPv4 Address Request', length=4, address='10.42.0.3')])
ie.Extension == 1 and ie.PPP == 3 and ie.Protocols[0].address == '10.42.0.3'

= IE_EPCO, dissection
h = "d89ef3da40e2fa163e956dce08004500003000010000401144e10a0f0f3d0a0f1281084b084b001c0c154821000c0000000100000100c500040080001b00"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.Protocols[0].type == 27

= IE_EPCO, basic instantiation
ie = IE_EPCO(Protocols=[PCO_S_Nssai(type=27, length=0)], ietype=197, length=4, CR_flag=0, instance=0, Extension=1, SPARE=0, PPP=0)
ie.Extension == 1 and ie.ietype == 197 and ie.Protocols[0].type == 27 and ie.Protocols[0].length == 0

= IE_APCO, dissection
h = "d89ef3da40e2fa163e956dce0800450000360001000040115d650a0f0f3d01020304084b084b00220000482000160000000100000100a3000a0080000c00001200000d00"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.Protocols[0].type == 12 and ie.Protocols[1].type == 18 and ie.Protocols[2].type == 13

= IE_APCO, basic instantiation
ie = IE_APCO(Protocols=[PCO_P_CSCF_IPv4_Address_Request(address=None, type=12, length=0),PCO_P_CSCF_Re_selection_Support(type=18, length=0),PCO_DNS_Server_IPv4(address=None, type=13, length=0)], ietype=163, length=10, CR_flag=0, instance=0, extension=1, SPARE=0, PPP=0)
ie.extension == 1 and ie.ietype == 163 and ie.length == 10 and ie.Protocols[0].type == 12 and ie.Protocols[1].type == 18 and ie.Protocols[2].type == 13

= IE_MMContext_EPS, dissection
h = "d89ef3da40e2fa163e956dce08004500007f0001000040114bbd0a0a0f3d0a0f0b5b084b084b006b5a234883005f0000180f76d163006b0046008800910000020000021890aa80be385102083701a2907066f8bd9f2a28b717671c71c71c71c71c71c70100003d090002625a00028040000812345678900000000000000000006d000900880005000470677731"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.Sec_Mode == 4 and ie.Nhi == 0 and ie.Drxi == 1 and ie.Ksi == 0 and ie.Num_quint == 0 and ie.Num_Quad == 0 and ie.Uambri == 0 and ie.Osci == 0 and ie.Sambri == 1 and ie.Nas_algo == 1 and ie.Nas_cipher == 1 and ie.Nas_dl_count == 2 and ie.Nas_ul_count == 2 and ie.Kasme == 11111111111111111111111111111111111111111111111111111111111111111111111111111

= IE_MMContext_EPS, basic instantiation
ie = IE_MMContext_EPS(ietype=107, length=70, CR_flag=0, instance=0, Sec_Mode=4, Nhi=0, Drxi=1, Ksi=0, Num_quint=0, Num_Quad=0, Uambri=0, Osci=0, Sambri=1, Nas_algo=1, Nas_cipher=1, Nas_dl_count=2, Nas_ul_count=2, Kasme=11111111111111111111111111111111111111111111111111111111111111111111111111111)
ie.Sec_Mode == 4 and ie.Nhi == 0 and ie.Drxi == 1 and ie.Ksi == 0 and ie.Num_quint == 0 and ie.Num_Quad == 0 and ie.Uambri == 0 and ie.Osci == 0 and ie.Sambri == 1 and ie.Nas_algo == 1 and ie.Nas_cipher == 1 and ie.Nas_dl_count == 2 and ie.Nas_ul_count == 2 and ie.Kasme == 11111111111111111111111111111111111111111111111111111111111111111111111111111

= IE_PDNConnection, IE_FQDN, dissection
h = "d89ef3da40e2fa163e956dce08004500007f0001000040114bbd0a0a0f3d0a0f0b5b084b084b006b5a234883005f0000180f76d163006b0046008800910000020000021890aa80be385102083701a2907066f8bd9f2a28b717671c71c71c71c71c71c70100003d090002625a00028040000812345678900000000000000000006d000900880005000470677731"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[1].IE_list[0]
ie.fqdn_tr_bit == 4 and ie.fqdn == b'pgw1'

= IE_PDNConnection, IE_FQDN, basic instantiation
ie = IE_PDNConnection(IE_list=[IE_FQDN(ietype=136, length=5, CR_flag=0, instance=0, fqdn_tr_bit=4, fqdn=b'pgw1')], ietype=109, length=9, CR_flag=0, instance=0)
ie2 = ie.IE_list[0]
ie2.fqdn_tr_bit == 4 and ie2.fqdn == b'pgw1'

= IE_PAA, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[9]
ie.PDN_type == 1 and ie.ipv4 == '127.0.0.3'

= IE_PAA, basic instantiation
ie = IE_PAA(ietype='PAA', length=5, PDN_type='IPv4', ipv4='127.0.0.3')
ie.ietype == 79 and ie.PDN_type == 1 and ie.ipv4 == '127.0.0.3'

= IE_Bearer_QoS, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[12].IE_list[2]
ie.MaxBitRateForUplink == 0 and ie.MaxBitRateForDownlink == 0 and ie.QCI == 7

= IE_Bearer_QoS, basic instantiation
ie = IE_Bearer_QoS(ietype='Bearer QoS', length=22, PCI=4, PriorityLevel=5, PVI=6, QCI=7,
                          MaxBitRateForUplink=1, MaxBitRateForDownlink=2, GuaranteedBitRateForUplink=3, GuaranteedBitRateForDownlink=4)
ie.ietype == 80 and ie.PCI == 4 and ie.PriorityLevel == 5 and ie.PVI == 6 and ie.QCI == 7 and ie.MaxBitRateForUplink == 1 and ie.MaxBitRateForDownlink == 2 and ie.GuaranteedBitRateForUplink == 3 and ie.GuaranteedBitRateForDownlink == 4

= IE_RAT, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[4]
ie.RAT_type == 6

= IE_RAT, basic instantiation
ie = IE_RAT(ietype='RAT', length=1, RAT_type='EUTRAN')
ie.ietype == 82 and ie.RAT_type == 6

= IE_ServingNetwork, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[3]
ie.MCC == b'234' and ie.MNC == b'02'

= IE_ServingNetwork, basic instantiation
ie = IE_ServingNetwork(
    ietype='Serving Network', length=3, MCC='234', MNC='02')
ie.ietype == 83 and ie.MCC == b'234' and ie.MNC == b'02'

= IE_ULI, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[2]
ie.TAI_Present == 1 and ie.ECGI_Present == 1 and ie.TAI.MCC == b'234' and ie.TAI.MNC == b'02' and ie.TAI.TAC == 12345 and ie.ECGI.MCC == b'234' and ie.ECGI.MNC == b'02' and ie.ECGI.ECI == 123456

= IE_ULI, basic instantiation
ie = IE_ULI(ietype='ULI', length=13, LAI_Present=0, ECGI_Present=1, TAI_Present=1, RAI_Present=0, SAI_Present=0,
                   CGI_Present=0, TAI=ULI_TAI(MCC='234', MNC='02', TAC=12345), ECGI=ULI_ECGI(MCC='234', MNC='02', ECI=123456))
ie.ietype == 86 and ie.LAI_Present == 0 and ie.ECGI_Present == 1 and ie.TAI_Present == 1 and ie.RAI_Present == 0 and ie.SAI_Present == 0 and ie.CGI_Present == 0 and ie.TAI.MCC == b'234' and ie.TAI.MNC == b'02' and ie.TAI.TAC == 12345 and ie.ECGI.MCC == b'234' and ie.ECGI.MNC == b'02' and ie.ECGI.ECI == 123456

= IE_UCI, dissection
h = "fe1d70fa717ceeeeeeeeeeee080045000127a4f500003c11e9aec0a8ee80c0a87f50084b23a301131aa1482001070000000001020f009100080021f3540000001602"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.CSG_ID == 22 and ie.AccessMode == 0 and ie.LCSG == 1 and ie.CMI == 0 and ie.MCC == b'123' and ie.MNC == b'45'

= IE_UCI, basic instantiation
ie = IE_UCI(ietype='UCI', length=8, CR_flag=0, instance=0, MCC=b'123', MNC=b'45', SPARE1=0, SPARE2=0, CSG_ID=22, AccessMode=0, LCSG=1, CMI=0)
ie.ietype == 145 and ie.CSG_ID == 22 and ie.AccessMode == 0 and ie.LCSG == 1 and ie.CMI == 0 and ie.MCC == b'123' and ie.MNC == b'45'

= IE_BearerFlags, dissection
h = "0026f126c100000c29b131dd81004d040800450000d8a6010000401118680a2180350a212735084b138800c47f8248210011000023f2000001005d006200610001000a"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0].IE_list[0]
ie.ASI == 1 and ie.Vind == 0 and ie.VB == 1 and ie.PPC == 0

= IE_BearerFlags, basic instantiation
ie = IE_BearerFlags(ietype='Bearer Flags', length=1, CR_flag=0, instance=0, SPARE=0, ASI=1, Vind=0, VB=1, PPC=0)
ie.ietype == 97 and ie.ASI == 1 and ie.Vind == 0 and ie.VB == 1 and ie.PPC == 0

= IE_UPF_SelInd_Flags, dissection
h = "000c29b131dd0026f126c10081000d04080045000112608940003f111ea60a2127350a2180351388084b00fe0ec44820000d0000000000000100ca00010000"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.DCNR == 0

= IE_UPF_SelInd_Flags, basic instantiation
ie = IE_UPF_SelInd_Flags(ietype='UP Function Selection Indication Flags', length=1, CR_flag=0, instance=0, SPARE=0, DCNR=0)
ie.ietype == 202 and ie.DCNR == 0

= IE_Ran_Nas_Cause, dissection
h = "00000000000000000000000008004500005a0000000040114d390101010101010102084b084b0046bf694824000e000ba0df00002300ac0002003011"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.protocol_type == 3 and ie.cause_type == 0 and ie.cause_value == 17

= IE_Ran_Nas_Cause, basic instantiation
ie = IE_Ran_Nas_Cause(ietype='RAN/NAS Cause', length=2, CR_flag=0, instance=0, protocol_type=3, cause_type=0, cause_value=17)
ie.ietype == 172 and ie.protocol_type == 3 and ie.cause_type == 0 and ie.cause_value == 17

= IE_FQCSID, dissection
h = "d89ef3da40e2fa163e956dce0800450000330001000040117a2a0a0f0f3d0a09dd3a084b084b001f454648240013000000010000010084000700010a01010b00c8"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[0]
ie.ietype == 132 and ie.nodeid_type == 0 and ie.num_csid == 1 and ie.nodeid_v4 == '10.1.1.11' and ie.csid == 200

= IE_FQCSID, basic instantiation
ie = IE_FQCSID(ietype=132, length=19, CR_flag=0, instance=0, nodeid_type=1, num_csid=1, nodeid_v4=None, nodeid_v6=42540578207381523466529575969228128257, nodeid_nonip=None, csid=0)
ie.ietype == 132 and ie.nodeid_type == 1 and ie.num_csid == 1 and ie.nodeid_v6 == 42540578207381523466529575969228128257 and ie.csid == 0

= IE_FTEID, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[5]
ie.GRE_Key == 4242 and ie.ipv4 == '127.0.0.2'

= IE_FTEID, basic instantiation
ie = IE_FTEID(ietype='F-TEID', length=9, ipv4_present=1,
                     InterfaceType=10, GRE_Key=0x1092, ipv4='127.0.0.2')
ie.ietype == 87 and ie.ipv4_present == 1 and ie.InterfaceType == 10 and ie.GRE_Key == 0x1092 and ie.ipv4 == '127.0.0.2'

= IE_BearerContext, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[12]
len(ie.IE_list) == 3 and ie.IE_list[0].ietype == 73 and ie.IE_list[0].EBI == 229 and ie.IE_list[
    1].ietype == 87 and ie.IE_list[1].ipv4 == '127.0.0.2' and ie.IE_list[2].ietype == 80 and ie.IE_list[2].QCI == 7

= IE_BearerContext, basic instantiation
ie = IE_BearerContext(ietype='Bearer Context', length=44, IE_list=[
                             IE_EPSBearerID(ietype='EPS Bearer ID', length=1, EBI=229)])
ie.ietype == 93 and len(ie.IE_list) == 1 and ie.IE_list[
    0].ietype == 73 and ie.IE_list[0].EBI == 229

= IE_ChargingID, dissection
h = "3333333333332222222222228100838408004580006d00000000f31180d20a2a00010a2a0002084b85930059e49a4823004da0316b4d96ac2c000200020010004c00060011111111111149000100c348000800000061a8000249f07f000100005d001300490001003f0200020010005e00040039004f454a0004007f00000436f73a63"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[5].IE_list[2]
ie.ChargingID == 956321605

= IE_ChargingID, basic instantiation
ie = IE_ChargingID(ietype='Charging ID', length=4, ChargingID=956321605)
ie.ietype == 94 and ie.ChargingID == 956321605

= IE_ChargingCharacteristics, dissection
h = "3333333333332222222222228100a384080045b8011800000000fc1193150a2a00010a2a00027be5084b010444c4482000f82fd783953790a2000100080002081132547600004c0006001111111111114b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a001961616161616161616161616161616161616161616161616161800001000063000100014f000500017f0000034d000400000800007f00010000480008000000c3500002e6304e001a008080211001000010810600000000830600000000000d00000a005d001f00490001000750001600190700000000000000000000000000000000000000007200020014005f0002000a008e80b09f"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[18]
ie.ChargingCharacteristric == 0xa00

= IE_ChargingCharacteristics, basic instantiation
ie = IE_ChargingCharacteristics(
    ietype='Charging Characteristics', length=2, ChargingCharacteristric=0xa00)
ie.ietype == 95 and ie.ChargingCharacteristric == 0xa00

= IE_PDN_type, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[8]
ie.PDN_type == 1

= IE_PDN_type, basic instantiation
ie = IE_PDN_type(ietype='PDN Type', length=1, PDN_type='IPv4')
ie.ietype == 99 and ie.PDN_type == 1

= IE_UE_Timezone, dissection
h = "3333333333332222222222228100a384080045b800ed00000000fc1193430a2a00010a2a00027f61084b00d91c47482000cd140339f4d99f66000100080002081132547600004b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a00196161616161616161616161616161616161616161616161616163000100014f000500017f0000034d0004000808000048000800000017000000a4105d002c0049000100e55700090385000010927f00000250001600580700000000000000000000000000000000000000007200020014005311004c"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[13]
ie.Timezone == 20 and ie.DST == 0

= IE_UE_Timezone, basic instantiation
ie = IE_UE_Timezone(ietype='UE Time zone', length=2, Timezone=20, DST=0)
ie.ietype == 114 and ie.Timezone == 20 and ie.DST == 0

= IE_UE_Timezone, basic instantiation
ie = IE_UE_Timezone(ietype='UE Time zone', length=2, Timezone=20, DST=1)
ie.ietype == 114 and ie.Timezone == 20 and ie.DST == 1

= IE_Port_Number, dissection
h = "00010203040800808e8f8ab608004500004100010000401169140b00019705000001ec45084b002da8524820001d00000000006e400001000700420061896453f44a0004005f1e1d737e0002004532"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[2]
ie.PortNumber == 17714

= IE_Port_Number, basic instantiation
ie = IE_Port_Number(
    ietype='Port Number', length=2, PortNumber=17714)
ie.ietype == 126 and ie.PortNumber == 17714

= IE_APN_Restriction, dissection
h = "3333333333332222222222228100838408004580006d00000000f31180d20a2a00010a2a0002084b85930059e49a4823004d55819f6500ede7000200020010004c000600111111111111490001003248000800000061a8000249f07f000100005d001300490001000b0200020010005e00040039004f454a0004007f00000436f73a63"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[4]
ie.APN_Restriction == 0

= IE_APN_Restriction, basic instantiation
ie = IE_APN_Restriction(
    ietype='APN Restriction', length=1, APN_Restriction=0)
ie.ietype == 127 and ie.APN_Restriction == 0

= IE_SelectionMode, dissection
h = "3333333333332222222222228100a384080045b8011800000000fc1193150a2a00010a2a00027be5084b010444c4482000f8093ca4cc47fa69000100080002081132547600004c0006001111111111114b000800000000000001e24056000d001832f420303932f4200001e2405300030032f4205200010006570009008a000010927f0000025700090187000010927f00000247001a001961616161616161616161616161616161616161616161616161800001000063000100014f000500017f0000034d000400000800007f00010000480008000000c3500002e6304e001a008080211001000010810600000000830600000000000d00000a005d001f00490001004850001600190700000000000000000000000000000000000000007200020014005f0002000a008e80b09f"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[9]
ie.SelectionMode == 0

= IE_SelectionMode, basic instantiation
ie = IE_SelectionMode(
    ietype='Selection Mode', length=1, SelectionMode=4)
ie.ietype == 128 and ie.SelectionMode == 4

= IE_MMBR, dissection
h = "3333333333332222222222228100838408004580014c97af0000f011830e0a2a00010a2a000282d5084b013876a74820012c29694a667f4a0b000100080002081132547600004c0006001111111111114b000800000000000001e24056000f000632f42030391a8532f42030391a855300030032f420520001000157001900c6000010927f0000020000000000000000000000000000fe8247001a001961616161616161616161616161616161616161616161616161800001000063000100014f000500017f0000034d000400000000007f000100004800080000001640000052084e00200080c02306010000060000802110010000108106000000008306000000000005005d003c00490001006057001902c4000010927f0000020000000000000000000000000000fe825000160029080000000000000000000000000000000000000000720002006e005f0002000a00a10008000000164000005208e4701ad2"
gtp = Ether(hex_bytes(h))
ie = gtp.IE_list[18]
ie.uplink_rate == 5696 and ie.downlink_rate == 21000

= IE_MMBR, basic instantiation
ie = IE_MMBR(ietype='Max MBR/APN-AMBR (MMBR)',
                    length=8, uplink_rate=5696, downlink_rate=21000)
ie.ietype == 161 and ie.uplink_rate == 5696 and ie.downlink_rate == 21000

= GTPHeader isn't an answer to not GTPHeader instance
GTPHeader(gtp_type=2).answers(Ether()) == False

= GTPHeader is an answer to a message with the same sequence number
GTPHeader(seq=42).answers(GTPHeader(seq=42)) == True

= GTPHeader isn't an answer to a message with a different sequence number
GTPHeader(seq=42).answers(GTPHeader(seq=24)) == False

= GTPV2EchoResponse answers
assert (GTPHeader(seq=1)/GTPV2EchoResponse()).answers(GTPHeader(seq=1)/GTPV2EchoRequest())
assert not (GTPHeader(seq=1)/GTPV2EchoResponse()).answers(GTPHeader(seq=1)/GTPV2EchoResponse())

= GTPHeader post_build
gtp = GTPHeader(gtp_type="create_session_req") / ("X"*32)
gtp.show2()

= GTPHeader hashret
req = GTPHeader(gtp_type="create_session_req", seq=1) / ("X"*32)
res = GTPHeader(gtp_type="create_session_res", seq=1) / ("Y"*32)
req.hashret() == res.hashret()

= IE_NotImplementedTLV
h = "333333333333222222222222810080c808004588002937dd0000fd1115490a2a00010a2a0002084b084b00152d0e4001000900000100fe0001000daa000000003f1f382f"
gtp = Ether(hex_bytes(h))
isinstance(gtp.IE_list[0], IE_NotImplementedTLV)
isinstance(gtp.IE_list[0].payload, NoPayload)

= IE_PrivateExtension, dissection
h = "d89ef3da40e2fa163e956dce08004500005b0001000040115d400a0f0f3d01020304084b084b00470000482000620000000100000100ff0015000137020046462d46462d46462d46462d46462d4646ff00160001370100000100000000000000000000000000000000"
gtp = Ether(hex_bytes(h))
ie1 = gtp.IE_list[0]
ie2 = gtp.IE_list[1]
ie1.enterprisenum == 311 and bytes_hex(ie1.proprietaryvalue) == b'020046462d46462d46462d46462d46462d4646'
ie2.enterprisenum == 311 and bytes_hex(ie2.proprietaryvalue) == b'0100000100000000000000000000000000000000'

= IE_PrivateExtension, basic instantiation
ie1 = IE_PrivateExtension(ietype=255, length=21, SPARE=0, instance=0, enterprisenum=311, proprietaryvalue=hex_bytes('020046462d46462d46462d46462d46462d4646'))
ie2 = IE_PrivateExtension(ietype=255, length=22, SPARE=0, instance=0, enterprisenum=311, proprietaryvalue=hex_bytes('0100000100000000000000000000000000000000'))
ie1.enterprisenum == 311 and bytes_hex(ie1.proprietaryvalue) == b'020046462d46462d46462d46462d46462d4646'
ie2.enterprisenum == 311 and bytes_hex(ie2.proprietaryvalue) == b'0100000100000000000000000000000000000000'

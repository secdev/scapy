% TLS 1.3 session - DEBUG

+ Debug - use data of https://tls13.ulfheim.net/
~ crypto
* So that it's easy to see what goes wrong

= Run tests

import binascii
from cryptography.hazmat.primitives.asymmetric.ec import EllipticCurvePrivateNumbers
from cryptography.hazmat.primitives.asymmetric.x25519 import X25519PrivateKey
from cryptography.hazmat.backends import default_backend

def clean(s):
    return binascii.unhexlify(''.join(c for c in s if c.isalnum()))

privatekey_client = hex_bytes("202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f")

clientHello = TLS(
    clean("""16 03 01 00 ca 01 00 00 c6 03 03 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff 00 06 13 01 13 02 13 03 01 00 00 77 00 00 00 18 00 16 00 00 13 65 78 61 6d 70 6c 65 2e 75 6c 66 68 65 69 6d 2e 6e 65 74 00 0a 00 08 00 06 00 1d 00 17 00 18 00 0d 00 14 00 12 04 03 08 04 04 01 05 03 08 05 05 01 08 06 06 01 02 01 00 33 00 26 00 24 00 1d 00 20 35 80 72 d6 36 58 80 d1 ae ea 32 9a df 91 21 38 38 51 ed 21 a2 8e 3b 75 e9 65 d0 d2 cd 16 62 54 00 2d 00 02 01 01 00 2b 00 03 02 03 04 """)
)

privkey = X25519PrivateKey.from_private_bytes(privatekey_client)
clientHello.tls_session.tls13_client_privshares["x25519"] = privkey

# ServerHello

privatekey_server = hex_bytes("909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeaf")

tls_session=clientHello.tls_session.mirror()
privkey = X25519PrivateKey.from_private_bytes(privatekey_server)
tls_session.tls13_server_privshare["x25519"] = privkey

serverHello = TLS(
    clean("""16 03 03 00 7a 02 00 00 76 03 03 70 71 72 73 74 75 76 77 78 79 7a 7b 7c 7d 7e 7f 80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f 20 e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff 13 01 00 00 2e 00 33 00 24 00 1d 00 20 9f d7 ad 6d cf f4 29 8d d3 f9 6d 5b 1b 2a f9 10 a0 53 5b 14 88 d7 f8 fa bb 34 9a 98 28 80 b6 15 00 2b 00 02 03 04 """),
    tls_session=tls_session
)

# Server CHange Cipher Spec

serverChangeCipherSpec = TLS(
    clean("14 03 03 00 01 01 "),
    tls_session=tls_session
)
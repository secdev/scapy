language: python

matrix:
    include:
        # Run as a regular user
        - os: linux
          dist: trusty
          python: 2.7

        - os: linux
          dist: trusty
          python: pypy

        - os: osx
          language: generic

        - os: osx
          language: generic
          env:
            - SCAPY_SUDO=false SCAPY_USE_PCAPDNET=yes

        # Run as root
        - os: linux
          dist: trusty
          sudo: required
          python: 2.7
          env:
            - SCAPY_SUDO="sudo -H"

        - os: linux
          dist: trusty
          sudo: required
          python: 2.7
          env:
            - SCAPY_SUDO="sudo -H" SCAPY_COVERAGE=yes

        - os: linux
          dist: trusty
          sudo: required
          python: 2.7
          services: docker
          before_install:
            - docker run -d -p 69:69/udp jumanjiman/tftp-hpa
          env:
            - SCAPY_SUDO="sudo -H" SCAPY_USE_PCAPDNET=yes SCAPY_COVERAGE=yes 

        - os: osx
          language: generic
          env:
            - SCAPY_SUDO="sudo -H" SCAPY_COVERAGE=yes

        - os: osx
          language: generic
          env:
            - SCAPY_SUDO="sudo -H" SCAPY_USE_PCAPDNET=yes SCAPY_COVERAGE=yes

install: bash .travis/install.sh

script: bash .travis/test.sh

after_success:
    - if [ "$SCAPY_COVERAGE" = "yes" ]; then pip install codecov; fi
    # With UTScapy, the coverage dot file is located in the test directory
    - if [ "$SCAPY_COVERAGE" = "yes" ]; then coverage combine ./test; fi
    - if [ "$SCAPY_COVERAGE" = "yes" ]; then codecov; fi
